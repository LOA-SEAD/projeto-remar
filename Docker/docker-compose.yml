version: '3'
services:
  mysql:
    image: mysql
    restart: always
    env_file:
      - .env
    volumes:
      - 'mysql-data:/var/lib/mysql'
      - './database:/tmp/db'
    command: mysqld --init-file="/tmp/db/db_startup.sql"
    ports:
      - '3306:3306'
  mongodb:
    env_file:
      - .env
    image: tutum/mongodb:latest
    volumes: 
      - 'mongo-data:/data/db'
    ports:
      - '27017:27017'
      - '28017:28017'
  remar:
      build: 
        context: .
        dockerfile: remar-app-dockerfile
      restart: always
      ports:
        - '8080:8080'
      volumes:
          - '~/volume_docker_remar:/usr/local/tomcat/webapps'
      links:
        - mongodb
      tty: true
volumes:
  mongo-init:
  mongo-data:
    driver: convoy
  mysql-data:
    driver: convoy
  remar-data:
    driver: convoy